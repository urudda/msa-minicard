<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="com.minibank.inquiry.domain.repository.InquiryRepository">
    <insert id="insertCustomer" parameterType="com.minibank.inquiry.domain.entity.Customer">
		INSERT INTO TB_CSTM_CQRS(CSTM_ID, CSTM_NM, CSTM_AGE, CSTM_GND, CSTM_PN, CSTM_ADR)
		VALUES(#{cstmId}, #{cstmNm}, #{cstmAge}, #{cstmGnd}, #{cstmPn}, #{cstmAdr})
    </insert>
    <insert id="insertAccount" parameterType="com.minibank.inquiry.domain.entity.Account">
		INSERT INTO TB_ACNT_CQRS(ACNT_NO, CSTM_ID, ACNT_NM, NEW_DTM)
		VALUES(#{acntNo}, #{cstmId}, #{acntNm}, TO_CHAR(CURRENT_TIMESTAMP,'YYYY-MM-DD HH24:MI:SS'));
    </insert>
    <update id="updateTransferLimit" parameterType="com.minibank.inquiry.domain.entity.Customer">
		UPDATE TB_CSTM_CQRS SET ONE_TM_TRNF_LMT = #{oneTmTrnfLmt}, ONE_DY_TRNF_LMT = #{oneDyTrnfLmt} WHERE CSTM_ID = #{cstmId};
    </update>
    <update id="updateAccountBalance" parameterType="com.minibank.inquiry.domain.entity.Account">
    	UPDATE TB_ACNT_CQRS SET ACNT_BLNC = ${acntBlnc} WHERE ACNT_NO = #{acntNo};
    </update>
 	<select id="selectCustomer" resultType="com.minibank.inquiry.domain.entity.Customer" parameterType="com.minibank.inquiry.domain.entity.Customer">
 		SELECT CSTM_ID, CSTM_NM, CSTM_AGE, CSTM_GND, CSTM_PN, CSTM_ADR, ONE_TM_TRNF_LMT, ONE_DY_TRNF_LMT
 		FROM TB_CSTM_CQRS
 		WHERE CSTM_ID = #{cstmId}
 	</select>
 	<select id="selectAccountList" resultType="com.minibank.inquiry.domain.entity.Account" parameterType="com.minibank.inquiry.domain.entity.Account">
 		SELECT ACNT_NO, CSTM_ID, ACNT_NM, NEW_DTM, ACNT_BLNC
 		FROM TB_ACNT_CQRS
 		WHERE CSTM_ID = #{cstmId}
 	</select>
 	
	<select id="selectDormantCustomerList" resultType="com.minibank.inquiry.domain.entity.RecentWork" parameterType="com.minibank.inquiry.domain.entity.RecentWork">
		<![CDATA[
		SELECT CSTM_ID, CSTM_NM, RCNT_WORK_DIV_CD, RCNT_WORK_DTM, WORK_ACNT_NO, WORK_TRNS_AMT, WORK_STS_CD
		FROM TB_RCNT_WORK
		WHERE RCNT_WORK_DTM < TO_CHAR((CURRENT_TIMESTAMP - INTERVAL'1 MINUTE'),'YYYY-MM-DD HH24:MI:SS')
		]]>
	</select>
	<insert id="insertCreatingCustomerWork" parameterType="com.minibank.inquiry.domain.entity.RecentWork">
		INSERT INTO TB_RCNT_WORK(CSTM_ID, CSTM_NM, RCNT_WORK_DIV_CD, RCNT_WORK_DTM, WORK_ACNT_NO, WORK_TRNS_AMT, WORK_STS_CD)
		VALUES(#{cstmId}, #{cstmNm}, #{rcntWorkDivCd}, TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'), '', 0, #{workStsCd})
	</insert>
	<update id="updateCreatingAccountWork" parameterType="com.minibank.inquiry.domain.entity.RecentWork">
		UPDATE TB_RCNT_WORK 
		SET RCNT_WORK_DTM = TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS')
			, RCNT_WORK_DIV_CD = #{rcntWorkDivCd}
			, WORK_ACNT_NO = #{workAcntNo}
			, WORK_STS_CD = #{workStsCd}
		WHERE CSTM_ID = #{cstmId}
	</update>
	<update id="updateTransactionWork" parameterType="com.minibank.inquiry.domain.entity.RecentWork">
		UPDATE TB_RCNT_WORK 
		SET RCNT_WORK_DTM = TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS')
			, RCNT_WORK_DIV_CD = #{rcntWorkDivCd}
			<if test="workTrnsAmt !=null and workTrnsAmt != ''">
			, WORK_TRNS_AMT = #{workTrnsAmt}
			</if>
			, WORK_STS_CD = #{workStsCd}
		WHERE WORK_ACNT_NO = #{workAcntNo}
	</update>
	<update id="updateTransferWork" parameterType="com.minibank.inquiry.domain.entity.RecentWork">
		UPDATE TB_RCNT_WORK 
		SET RCNT_WORK_DTM = TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS')
			, RCNT_WORK_DIV_CD = #{rcntWorkDivCd}
			, WORK_ACNT_NO = #{workAcntNo}
			<if test="workTrnsAmt !=null and workTrnsAmt != ''">
			, WORK_TRNS_AMT = #{workTrnsAmt}
			</if>
			, WORK_STS_CD = #{workStsCd}
		WHERE CSTM_ID = #{cstmId}
	</update>
	
</mapper>
